<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Panel Uniwersytetu</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; border: 1px solid #ddd; padding: 15px; background: #f9f9f9; }
        input, textarea { width: 100%; margin-bottom: 10px; padding: 8px; box-sizing: border-box;}
        button { background: #28a745; color: white; border: none; padding: 10px 20px; cursor: pointer; }
        
        /* WyglÄ…d pojedynczego artykuÅ‚u */
        .artykul { border-bottom: 1px solid #ccc; padding: 20px 0; display: flex; gap: 20px; }
        .artykul img { max-width: 150px; height: auto; object-fit: cover; }
        #lista-artykulow{
            max-height: 50vh;
            overflow-y: scroll;
        }
    </style>
    <script src="../scripts/admin_auth.js"></script>
</head>
<body>

    <h1>ZarzÄ…dzanie AktualnoÅ›ciami</h1>

    <div class="form-group">
        <h3>Dodaj nowy wpis</h3>
        <input type="text" id="naglowek" placeholder="TytuÅ‚ artykuÅ‚u">
        <input type="text" id="zdjecie" placeholder="Link do zdjÄ™cia (URL)">
        <textarea id="tresc" rows="4" placeholder="TreÅ›Ä‡ artykuÅ‚u..."></textarea>
        <button onclick="dodajArtykul()">Opublikuj</button>
    </div>

    <div id="lista-artykulow">
        </div>

    <script>
    // 1. Funkcja do wyÅ›wietlania listy (Å¼ebyÅ› widziaÅ‚ co dodaÅ‚eÅ›)
    async function pobierzArtykuly() {
        const response = await fetch('/api/aktualnosci');
        const data = await response.json();
        
        const lista = document.getElementById('lista-artykulow');
        lista.innerHTML = ''; 

        data.forEach(art => {
            const div = document.createElement('div');
            div.className = 'artykul';
            // Tutaj wyÅ›wietlamy miniaturkÄ™ w panelu admina
            div.innerHTML = `
                <div style="flex: 1">
                    <strong>${art.naglowek}</strong>
                    <p>${art.tresc.substring(0, 50)}...</p>
                    <img src="${art.zdjecieUrl}">
                </div>
            `;
            lista.appendChild(div);
        });
    }

    // 2. Funkcja do dodawania (POST)
    async function dodajArtykul() {
        const naglowek = document.getElementById('naglowek').value;
        const tresc = document.getElementById('tresc').value;
        // Tutaj teÅ¼ poprawka na zdjecieUrl
        const zdjecieUrl = document.getElementById('zdjecie').value || undefined;

        const response = await fetch('/api/aktualnosci', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ naglowek, tresc, zdjecieUrl })
        });

        if (response.ok) {
            alert('Dodano artykuÅ‚!');
            pobierzArtykuly(); // OdÅ›wieÅ¼amy listÄ™
            // CzyÅ›cimy pola
            document.getElementById('naglowek').value = '';
            document.getElementById('tresc').value = '';
            document.getElementById('zdjecie').value = '';
        } else {
            alert('BÅ‚Ä…d! SprawdÅº konsolÄ™.');
        }
    }

    // Na start Å‚adujemy listÄ™
    pobierzArtykuly();
</script>
<hr>
<div class="dodaj-studenta-sekcja">
    <h3>Dodaj Nowego UÅ¼ytkownika (Studenta)</h3>
    <form id="addStudentForm">
        
        <label for="login">Login (Wymagany):</label>
        <input type="text" id="login" name="login" required>

        <label for="haslo">HasÅ‚o (Wymagane):</label>
        <input type="password" name="haslo" id="haslo">
            <br>
        <label for="imie">ImiÄ™:</label>
        <input type="text" id="imie" name="imie">

        <label for="nazwisko">Nazwisko:</label>
        <input type="text" id="nazwisko" name="nazwisko">

        <label for="klasa">Klasa (Wymagana):</label>
        <input type="text" id="klasa" name="klasa" required>

        <label for="zdjecieURL">URL ZdjÄ™cia (Opcjonalny, DomyÅ›lny: awatar.png):</label>
        <input type="text" id="zdjecieURL" name="zdjecieURL" placeholder="np. /images/jan-kowalski.png">
        
        <button type="submit" onclick="addUser()">Dodaj Studenta</button>
        <p id="message"></p>
    </form>
</div>

<script>

    async function addUser() {
        const login = document.getElementById('login').value;
        const haslo = document.getElementById('haslo').value;
        const imie = document.getElementById('imie').value;
        const nazwisko = document.getElementById('nazwisko').value;
        const klasa = document.getElementById('klasa').value;
        const zdjecieURL = document.getElementById('zdjecieURL').value;

        const response = await fetch('/api/register',{

            method: 'POST',
            headers: { 'Content-Type': 'application/json'},
            body: JSON.stringify({ login, haslo, imie, nazwisko, zdjecieURL, klasa})
        });
        if(response.ok){
            alert('Dodano uzytkownika');

        }else{
            alert('BÅ‚Ä…d! Nie udalo sie dodaj uzytkownika.');
        }
        
    }

</script>

<hr>

<div class="form-group">
    <h3>Dodaj ZajÄ™cia</h3>

    <input type="text" id="z_nazwa" placeholder="Nazwa zajÄ™Ä‡ (np. Algorytmy)">
    <input type="text" id="z_prowadzacy" placeholder="ProwadzÄ…cy">
    <input type="text" id="z_dzien" placeholder="DzieÅ„ (np. PoniedziaÅ‚ek)">
    <input type="time" id="z_od">
    <input type="time" id="z_do">
    <input type="text" id="z_sala" placeholder="Sala">
    <input type="text" id="z_typ" placeholder="Typ (wykÅ‚ad / lab / Ä‡wiczenia)">

    <button onclick="dodajZajecia()">Dodaj zajÄ™cia</button>
</div>

<div id="lista-zajec"></div>

<script>
    async function pobierzZajecia() {
        const res = await fetch('/api/zajecia');
        const data = await res.json();

        const lista = document.getElementById('lista-zajec');
        lista.innerHTML = '<h3>Lista zajÄ™Ä‡</h3>';

        data.forEach(z => {
            const div = document.createElement('div');
            div.className = 'artykul';
            div.innerHTML = `
                <div style="flex:1">
                    <strong>${z.nazwa}</strong><br>
                    ${z.dzien} ${z.godzinaOd}â€“${z.godzinaDo}<br>
                    ${z.typ} | sala ${z.sala}<br>
                    <small>${z.prowadzacy}</small>
                </div>
            `;
            lista.appendChild(div);
        });
    }

    async function dodajZajecia() {
        const body = {
            nazwa: document.getElementById('z_nazwa').value,
            prowadzacy: document.getElementById('z_prowadzacy').value,
            dzien: document.getElementById('z_dzien').value,
            godzinaOd: document.getElementById('z_od').value,
            godzinaDo: document.getElementById('z_do').value,
            sala: document.getElementById('z_sala').value,
            typ: document.getElementById('z_typ').value
        };

        const res = await fetch('/api/zajecia', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
        });

        if (res.ok) {
            alert('Dodano zajÄ™cia ðŸ’ª');
            pobierzZajecia();

            Object.keys(body).forEach(id => {
                const el = document.getElementById('z_' + id.split(/(?=[A-Z])/)[0]);
                if (el) el.value = '';
            });
        } else {
            alert('BÅ‚Ä…d przy dodawaniu zajÄ™Ä‡ ðŸ˜¬');
        }
    }

    pobierzZajecia();
</script>




</body>
</html>